<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BulkUpdateé—®é¢˜ä¿®å¤æ–¹æ¡ˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .error-box {
            background: #fef2f2;
            border: 2px solid #fca5a5;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }
        .fix-box {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .feature-list {
            margin: 20px 0;
        }
        .feature-list li {
            margin: 8px 0;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #dc3545;
        }
        .success-list li {
            border-left-color: #28a745;
        }
        h1 { color: #1f2937; margin-bottom: 10px; }
        h2 { color: #374151; margin-top: 30px; margin-bottom: 15px; }
        h3 { color: #4b5563; margin-top: 25px; margin-bottom: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ BulkUpdateé—®é¢˜ä¿®å¤æ–¹æ¡ˆ</h1>
        
        <div class="error-box">
            <h2>âŒ å‘ç°çš„é—®é¢˜</h2>
            <p>æ ¹æ®æ‚¨æä¾›çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
            <div class="code-block">
â¤ï¸ åŒæ­¥æ ‡ç­¾å¤±è´¥: TypeError: $.tags.bulkUpdate is not a function
    at Xr (index-B5G5h1jG.js:31:65390)
    at async Dl (index-B5G5h1jG.js:31:66209)
            </div>
            <p><strong>æ ¹æœ¬åŸå› </strong>ï¼šDexie 3.2.5ç‰ˆæœ¬ä¸­æ²¡æœ‰<code>bulkUpdate</code>æ–¹æ³•ï¼Œè¿™å¯¼è‡´æ ‡ç­¾è®¡æ•°æ›´æ–°å¤±è´¥ã€‚</p>
        </div>
        
        <h2>ğŸ” é—®é¢˜åˆ†æ</h2>
        
        <ul class="feature-list">
            <li><strong>ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜</strong> - Dexie 3.xç‰ˆæœ¬çš„APIä¸æ›´é«˜ç‰ˆæœ¬ä¸åŒ</li>
            <li><strong>æ–¹æ³•ä¸å­˜åœ¨</strong> - <code>bulkUpdate</code>æ–¹æ³•åœ¨å½“å‰ç‰ˆæœ¬ä¸­ä¸å¯ç”¨</li>
            <li><strong>æ ‡ç­¾è®¡æ•°æ— æ³•æ›´æ–°</strong> - å¯¼è‡´æ‰€æœ‰æ ‡ç­¾æ˜¾ç¤ºä¸º0æ¡æ”¶è—</li>
        </ul>
        
        <div class="fix-box">
            <h2>âœ… ä¿®å¤æ–¹æ¡ˆ</h2>
            <p>æˆ‘å·²ç»å°†<code>bulkUpdate</code>æ–¹æ³•æ›¿æ¢ä¸ºå…¼å®¹çš„æ›´æ–°æ–¹å¼ï¼š</p>
        </div>
        
        <h3>ğŸ”§ ä¿®å¤å†…å®¹</h3>
        
        <h4>1. æ›´æ–° updateTagCount() æ–¹æ³•</h4>
        <p><strong>ä¿®å¤å‰</strong>ï¼ˆæœ‰é—®é¢˜çš„ä»£ç ï¼‰ï¼š</p>
        <div class="code-block">
// ä½¿ç”¨ä¸å­˜åœ¨çš„ bulkUpdate æ–¹æ³•
const updates = [];
for (const tag of tags) {
  // ... è®¡ç®—é€»è¾‘
  updates.push({ key: tag.id, changes: { count } });
}
if (updates.length > 0) {
  return db.tags.bulkUpdate(updates); // âŒ è¿™ä¸ªæ–¹æ³•ä¸å­˜åœ¨
}
        </div>
        
        <p><strong>ä¿®å¤å</strong>ï¼ˆæ­£ç¡®çš„ä»£ç ï¼‰ï¼š</p>
        <div class="code-block">
// ä½¿ç”¨äº‹åŠ¡å’Œç›´æ¥æ›´æ–°
return db.transaction('rw', db.tags, async () => {
  for (const tag of tags) {
    const count = await db.clips.filter(clip => 
      clip.tags && clip.tags.includes(tag.name)
    ).count();
    
    if (count !== tag.count) {
      await db.tags.update(tag.id, { count }); // âœ… ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•
    }
  }
});
        </div>
        
        <h4>2. å¢å¼ºé”™è¯¯å¤„ç†</h4>
        <ul class="feature-list success-list">
            <li>ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ“ä½œçš„åŸå­æ€§</li>
            <li>é€ä¸ªæ›´æ–°æ ‡ç­¾è®°å½•ï¼Œé¿å…æ‰¹é‡æ“ä½œå¤±è´¥</li>
            <li>æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—è¾“å‡º</li>
            <li>ä¸ºbulkAddæ·»åŠ é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶</li>
        </ul>
        
        <h3>ğŸ“Š ä¿®å¤æ•ˆæœ</h3>
        
        <p>ä¿®å¤åï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ­£ç¡®çš„è°ƒè¯•è¾“å‡ºï¼š</p>
        
        <div class="code-block">
ğŸ”„ å¼€å§‹æ›´æ–°æ ‡ç­¾è®¡æ•°...
ğŸ“‹ å½“å‰æ ‡ç­¾åˆ—è¡¨: [...]
ğŸ·ï¸ æ ‡ç­¾ "å·¥ä½œ" å½“å‰è®¡æ•°: 0, å®é™…è®¡æ•°: 1
âœ… å·²æ›´æ–°æ ‡ç­¾ "å·¥ä½œ" è®¡æ•°: 0 -> 1
ğŸ·ï¸ æ ‡ç­¾ "å·¥å…·" å½“å‰è®¡æ•°: 0, å®é™…è®¡æ•°: 1  
âœ… å·²æ›´æ–°æ ‡ç­¾ "å·¥å…·" è®¡æ•°: 0 -> 1
âœ… æ‰€æœ‰æ ‡ç­¾è®¡æ•°æ›´æ–°å®Œæˆ
        </div>
        
        <h2>ğŸš€ æµ‹è¯•æ­¥éª¤</h2>
        
        <ol style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
            <li><strong>é‡æ–°åŠ è½½æ‰©å±•</strong> - åœ¨Chromeæ‰©å±•ç®¡ç†é¡µé¢åˆ·æ–°QuickMagnet</li>
            <li><strong>æ‰“å¼€å¼€å‘è€…å·¥å…·</strong> - å³é”®æ‰©å±•å›¾æ ‡ > "æ£€æŸ¥å¼¹å‡ºå†…å®¹"</li>
            <li><strong>åˆ‡æ¢åˆ°æ ‡ç­¾è§†å›¾</strong> - åº”è¯¥ä¼šè‡ªåŠ¨è§¦å‘åŒæ­¥</li>
            <li><strong>æ£€æŸ¥æ§åˆ¶å°è¾“å‡º</strong> - ç¡®è®¤æ²¡æœ‰é”™è¯¯ä¿¡æ¯</li>
            <li><strong>éªŒè¯æ ‡ç­¾è®¡æ•°</strong> - æ ‡ç­¾åº”è¯¥æ˜¾ç¤ºæ­£ç¡®çš„æ”¶è—æ•°é‡</li>
        </ol>
        
        <h2>ğŸ¯ é¢„æœŸç»“æœ</h2>
        
        <div class="fix-box">
            <h3>æˆåŠŸä¿®å¤ååº”è¯¥çœ‹åˆ°ï¼š</h3>
            <ul class="feature-list success-list">
                <li>âœ… æ§åˆ¶å°ä¸å†å‡ºç°<code>bulkUpdate is not a function</code>é”™è¯¯</li>
                <li>âœ… æ ‡ç­¾è®¡æ•°æ­£ç¡®æ›´æ–°ï¼ˆå¦‚"å·¥ä½œ" 1æ¡æ”¶è—ï¼Œ"å·¥å…·" 1æ¡æ”¶è—ï¼‰</li>
                <li>âœ… æ ‡ç­¾è§†å›¾æ˜¾ç¤ºæ‰€æœ‰åŒ…å«æ ‡ç­¾çš„æ”¶è—</li>
                <li>âœ… ç‚¹å‡»æ ‡ç­¾èƒ½æ­£ç¡®è¿›å…¥è¯¥æ ‡ç­¾çš„æ”¶è—åˆ—è¡¨</li>
                <li>âœ… åŒæ­¥è¿‡ç¨‹å®Œæ•´å®Œæˆï¼Œæ— é”™è¯¯ä¿¡æ¯</li>
            </ul>
        </div>
        
        <h2>ğŸ”§ æŠ€æœ¯ç»†èŠ‚</h2>
        
        <h3>ä½¿ç”¨çš„Dexieæ–¹æ³•</h3>
        <ul class="feature-list">
            <li><code>db.tags.update(id, changes)</code> - æ›´æ–°å•ä¸ªè®°å½•</li>
            <li><code>db.transaction('rw', table, callback)</code> - äº‹åŠ¡å¤„ç†</li>
            <li><code>db.tags.add(object)</code> - æ·»åŠ å•ä¸ªè®°å½•</li>
            <li><code>db.clips.filter(predicate).count()</code> - æ¡ä»¶è®¡æ•°</li>
        </ul>
        
        <h3>å…¼å®¹æ€§ä¿è¯</h3>
        <ul class="feature-list success-list">
            <li>æ‰€æœ‰æ–¹æ³•éƒ½ä¸Dexie 3.2.5ç‰ˆæœ¬å…¼å®¹</li>
            <li>ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§</li>
            <li>æ·»åŠ é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶</li>
            <li>ä¿æŒå‘åå…¼å®¹æ€§</li>
        </ul>
        
        <div class="fix-box">
            <h3>âœ¨ æ€»ç»“</h3>
            <p>é€šè¿‡å°†ä¸å…¼å®¹çš„<code>bulkUpdate</code>æ–¹æ³•æ›¿æ¢ä¸ºæ ‡å‡†çš„<code>update</code>æ–¹æ³•å’Œäº‹åŠ¡å¤„ç†ï¼Œæ ‡ç­¾è®¡æ•°åŠŸèƒ½ç°åœ¨åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œã€‚æ‚¨çš„æ ‡ç­¾"å·¥ä½œ"å’Œ"å·¥å…·"åº”è¯¥åˆ†åˆ«æ˜¾ç¤º1æ¡æ”¶è—ã€‚</p>
            <p style="text-align: center; margin-top: 20px; color: #059669; font-weight: bold;">
                BulkUpdateå…¼å®¹æ€§é—®é¢˜å·²ä¿®å¤å®Œæˆï¼ğŸ‰
            </p>
        </div>
        
        <p style="text-align: center; margin-top: 30px; color: #666;">
            ç°åœ¨å¯ä»¥é‡æ–°åŠ è½½æ‰©å±•å¹¶éªŒè¯æ ‡ç­¾è®¡æ•°æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºäº† âœ¨
        </p>
    </div>
</body>
</html>