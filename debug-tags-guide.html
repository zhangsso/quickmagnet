<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>标签计数调试指南</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .debug-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }
        .step-box {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }
        .code-block {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .feature-list {
            margin: 20px 0;
        }
        .feature-list li {
            margin: 8px 0;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #17a2b8;
        }
        h1 { color: #1f2937; margin-bottom: 10px; }
        h2 { color: #374151; margin-top: 30px; margin-bottom: 15px; }
        h3 { color: #4b5563; margin-top: 25px; margin-bottom: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 标签计数调试指南</h1>
        
        <div class="debug-box">
            <h2>🚨 当前问题</h2>
            <p>标签视图中所有标签显示为"0条收藏"，即使实际上有收藏包含这些标签。</p>
        </div>
        
        <h2>🛠️ 调试步骤</h2>
        
        <div class="step-box">
            <h3>步骤 1: 重新加载扩展</h3>
            <ul class="feature-list">
                <li>在Chrome中打开 <code>chrome://extensions/</code></li>
                <li>找到QuickMagnet扩展</li>
                <li>点击刷新按钮重新加载扩展</li>
            </ul>
        </div>
        
        <div class="step-box">
            <h3>步骤 2: 打开开发者工具</h3>
            <ul class="feature-list">
                <li>右键点击扩展图标</li>
                <li>选择"检查弹出内容"</li>
                <li>切换到Console面板查看调试信息</li>
            </ul>
        </div>
        
        <div class="step-box">
            <h3>步骤 3: 切换到标签视图</h3>
            <ul class="feature-list">
                <li>打开QuickMagnet扩展面板</li>
                <li>点击标签视图按钮（标签图标）</li>
                <li>观察控制台输出的同步信息</li>
            </ul>
        </div>
        
        <div class="step-box">
            <h3>步骤 4: 使用调试按钮</h3>
            <p>如果标签视图显示"还没有标签"，会看到两个调试按钮：</p>
            <ul class="feature-list">
                <li><strong>🔍 调试标签</strong> - 分析当前标签数据状态</li>
                <li><strong>🔄 强制同步</strong> - 强制重新同步所有标签</li>
            </ul>
        </div>
        
        <h2>📊 期望的调试输出</h2>
        
        <p>点击"🔍 调试标签"按钮后，控制台应该显示类似以下信息：</p>
        
        <div class="code-block">
🔍 开始调试标签数据...
📊 总共 X 条收藏
📝 收藏 "xxx" 的标签: ["标签1", "标签2"]
🏷️ 所有使用的标签: ["标签1", "标签2", "标签3"]
💾 数据库中已存在的标签: [{name: "标签1", count: 0}, ...]
📊 手动计算标签计数:
  - "标签1": 数据库中记录=0, 实际计数=X
  - "标签2": 数据库中记录=0, 实际计数=Y
        </div>
        
        <h2>🔄 强制同步流程</h2>
        
        <p>点击"🔄 强制同步"按钮会执行以下操作：</p>
        
        <ul class="feature-list">
            <li>扫描所有收藏中使用的标签</li>
            <li>在数据库中创建缺失的标签记录</li>
            <li>重新计算每个标签的使用次数</li>
            <li>更新标签数据库记录</li>
            <li>刷新标签视图显示</li>
        </ul>
        
        <h2>📝 预期结果</h2>
        
        <div class="step-box">
            <h3>修复成功后应该看到：</h3>
            <ul class="feature-list">
                <li>✅ 控制台显示发现并同步了标签</li>
                <li>✅ 标签视图显示所有使用过的标签</li>
                <li>✅ 每个标签显示正确的收藏数量</li>
                <li>✅ 点击标签能进入对应的收藏列表</li>
            </ul>
        </div>
        
        <h2>🐛 常见问题排查</h2>
        
        <h3>问题1: 控制台无调试信息</h3>
        <ul class="feature-list">
            <li>确认扩展已重新加载</li>
            <li>确认开发者工具已正确打开</li>
            <li>尝试刷新扩展面板</li>
        </ul>
        
        <h3>问题2: 调试显示没有收藏包含标签</h3>
        <ul class="feature-list">
            <li>检查是否有收藏实际包含标签</li>
            <li>验证标签字段格式是否正确</li>
            <li>确认数据库连接正常</li>
        </ul>
        
        <h3>问题3: 强制同步后仍显示0</h3>
        <ul class="feature-list">
            <li>检查updateTagCount方法是否正确执行</li>
            <li>确认数据库更新操作是否成功</li>
            <li>验证标签计数逻辑是否准确</li>
        </ul>
        
        <div class="debug-box">
            <h3>💡 调试技巧</h3>
            <ul>
                <li>保持开发者工具的Console面板打开</li>
                <li>每次操作后都查看控制台输出</li>
                <li>记录错误信息以便进一步分析</li>
                <li>尝试多次点击"强制同步"按钮</li>
            </ul>
        </div>
        
        <p style="text-align: center; margin-top: 30px; color: #666;">
            请按照以上步骤进行调试，并将控制台输出的详细信息提供给我分析 🔍
        </p>
    </div>
</body>
</html>